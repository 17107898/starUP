<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Prestador</title>
    <link rel="stylesheet" href="/static/css/perfil_prestador.css">
</head>
<body>
    <form id="uploadForm" action="/editar_prestador" method="POST" enctype="multipart/form-data">
        <div class="profile-container">
            {% if is_owner %}
            <!-- Adicione o √≠cone de notifica√ß√£o na barra de navega√ß√£o ou no topo -->
            <div class="notification-container center-notification">
                <span class="notification-icon" onclick="abrirSolicitacoes()">
                    üîî
                    <span class="notification-count" id="notificationCount">0</span> <!-- Contador de notifica√ß√µes -->
                </span>
            </div>
        
            <!-- Popup de notifica√ß√µes -->
            <div id="popupSolicitacoes" class="popup-solicitacao" style="display: none;">
                <div class="popup-content-solicitacao">
                    <span class="popup-close" onclick="fecharSolicitacoes()">&times;</span>
                    <h3>Solicita√ß√µes de Servi√ßo</h3>
                    <ul id="solicitacoesList">
                        <!-- As solicita√ß√µes ser√£o carregadas aqui -->
                    </ul>
                </div>
            </div>            
        {% endif %}
        
            

        <!-- Foto de Perfil -->
        <div class="profile-header">
            <div class="profile-photo" 
            data-id="{{ perfil_foto }}" 
            style="background-image: url('/uploads/img/{{ perfil_foto }}');"></div>
            
            <h1>{{ prestador.nome }}</h1>
            {% if is_owner %}
            <!-- Campo din√¢mico para editar o m√©todo de contato -->
            <label for="contactMethod">Forma de Contato Preferencial:</label>
            <!-- Aqui ser√° exibido o campo de email ou telefone conforme a escolha -->
            <div id="contactDetail" style="display:none;">
                <label for="contactInput" id="contactLabel">
                    {% if prestador.metodo_contato == 'email' %}
                        Por favor, insira seu email:
                    {% elif prestador.metodo_contato == 'telefone' %}
                        Por favor, insira seu n√∫mero de telefone:
                    {% elif prestador.metodo_contato == 'whatsapp' %}
                        Por favor, insira seu n√∫mero do WhatsApp:
                    {% endif %}
                </label>
                <input type="text" id="contactInput" name="contato" value="{{ prestador.contato }}" 
                    placeholder="{% if prestador.metodo_contato == 'email' %}Digite seu email{% 
                    elif prestador.metodo_contato == 'telefone' %}Digite seu n√∫mero de telefone{% 
                    elif prestador.metodo_contato == 'whatsapp' %}Digite seu n√∫mero do WhatsApp{% 
                    endif %}" 
                    style="width: calc(100% - 20px); padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; background-color: #f9f9f9; transition: border-color 0.3s ease;">
            </div>

            <div id="currentContact" style="display: block;">
                <label for="currentContactInput">Contato Atual:</label>
                <input type="text" id="currentContactInput" name="contato_atual" value="{{ prestador.contato }}" readonly style="width: calc(100% - 20px); padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; background-color: #f1f1f1;">
            </div>

        
                <!-- Upload de nova foto de perfil -->
                <div class="photo-upload">
                    <label for="perfil_foto">Alterar Foto de Perfil:</label>
                    <input type="file" id="perfil_foto" name="perfil_foto" accept="image/*">
        
                    <!-- Bot√£o para remover a foto de perfil -->
                    <button type="button" id="remove-foto">Remover Foto de Perfil</button>
                </div>

            {% else %}

                <p><strong>Contato:</strong> {{ prestador.contato }}</p>
            {% endif %}
        </div>
        <!-- Informa√ß√µes do Servi√ßo -->
        <div class="service-info container">
            <h2>Servi√ßo Oferecido</h2>
            {% if is_owner %}
            <label for="service">Tipo de Servi√ßo:</label>
            <select id="service" name="service_type" required>
                <option value="">Selecione o servi√ßo</option>
                <option value="desenvolvimento_software" {% if prestador.service_type == 'desenvolvimento_software' %}selected{% endif %}>Desenvolvimento de Software</option>
                <option value="infraestrutura_ti" {% if prestador.service_type == 'infraestrutura_ti' %}selected{% endif %}>Infraestrutura de TI</option>
                <option value="seguranca_cibernetica" {% if prestador.service_type == 'seguranca_cibernetica' %}selected{% endif %}>Seguran√ßa Cibern√©tica</option>
                <option value="inteligencia_artificial" {% if prestador.service_type == 'inteligencia_artificial' %}selected{% endif %}>Intelig√™ncia Artificial</option>
                <option value="cloud_computing" {% if prestador.service_type == 'cloud_computing' %}selected{% endif %}>Computa√ß√£o em Nuvem</option>
                <option value="data_science" {% if prestador.service_type == 'data_science' %}selected{% endif %}>Ci√™ncia de Dados</option>
                <option value="desenvolvimento_web" {% if prestador.service_type == 'desenvolvimento_web' %}selected{% endif %}>Desenvolvimento Web</option>
                <option value="desenvolvimento_mobile" {% if prestador.service_type == 'desenvolvimento_mobile' %}selected{% endif %}>Desenvolvimento Mobile</option>
                <option value="iot" {% if prestador.service_type == 'iot' %}selected{% endif %}>Internet das Coisas (IoT)</option>
                <option value="suporte_tecnico" {% if prestador.service_type == 'suporte_tecnico' %}selected{% endif %}>Suporte T√©cnico</option>
                <option value="automacao_industrial" {% if prestador.service_type == 'automacao_industrial' %}selected{% endif %}>Automa√ß√£o Industrial</option>
                <option value="devops" {% if prestador.service_type == 'devops' %}selected{% endif %}>DevOps</option>
                <option value="analise_de_dados" {% if prestador.service_type == 'analise_de_dados' %}selected{% endif %}>An√°lise de Dados</option>
            </select>
            
        
                <label for="descricao">Descri√ß√£o:</label>
                <textarea name="descricao">{{ prestador.descricao }}</textarea>
        
                <label for="orcamento">Or√ßamento:</label>
                <input type="number" name="orcamento" value="{{ prestador.orcamento }}">
        
                <label for="urgency">Urg√™ncia:</label>
                <select id="urgency" name="urgencia" required>
                    <option value="">Selecione a urg√™ncia</option>
                    <option value="urgente" {% if prestador.urgencia == 'urgente' %}selected{% endif %}>Urgente</option>
                    <option value="semana" {% if prestador.urgencia == 'semana' %}selected{% endif %}>Dentro de uma semana</option>
                    <option value="mes" {% if prestador.urgencia == 'mes' %}selected{% endif %}>Dentro de um m√™s</option>
                    <option value="sem_prazo" {% if prestador.urgencia == 'sem_prazo' %}selected{% endif %}>Sem prazo espec√≠fico</option>
                </select>
                <br>
                
                
            {% else %}
                <p><strong>Tipo de Servi√ßo:</strong> 
                    {% if prestador.service_type == 'desenvolvimento_software' %}
                        Desenvolvimento de Software
                    {% elif prestador.service_type == 'infraestrutura_ti' %}
                        Infraestrutura de TI
                    {% elif prestador.service_type == 'seguranca_cibernetica' %}
                        Seguran√ßa Cibern√©tica
                    {% elif prestador.service_type == 'inteligencia_artificial' %}
                        Intelig√™ncia Artificial
                    {% elif prestador.service_type == 'cloud_computing' %}
                        Computa√ß√£o em Nuvem
                    {% elif prestador.service_type == 'data_science' %}
                        Ci√™ncia de Dados
                    {% elif prestador.service_type == 'desenvolvimento_web' %}
                        Desenvolvimento Web
                    {% elif prestador.service_type == 'desenvolvimento_mobile' %}
                        Desenvolvimento Mobile
                    {% elif prestador.service_type == 'iot' %}
                        Internet das Coisas (IoT)
                    {% elif prestador.service_type == 'suporte_tecnico' %}
                        Suporte T√©cnico
                    {% elif prestador.service_type == 'automacao_industrial' %}
                        Automa√ß√£o Industrial
                    {% elif prestador.service_type == 'devops' %}
                        DevOps
                    {% elif prestador.service_type == 'analise_de_dados' %}
                        An√°lise de Dados
                    {% else %}
                        Servi√ßo n√£o especificado
                    {% endif %}
                </p>
                
                <p><strong>Descri√ß√£o:</strong> {{ prestador.descricao }}</p>
                <p><strong>Or√ßamento:</strong> {{ prestador.orcamento }}</p>
                <p><strong>Urg√™ncia:</strong> 
                    {% if prestador.urgencia == 'urgente' %}
                        Urgente
                    {% elif prestador.urgencia == 'semana' %}
                        Dentro de uma semana
                    {% elif prestador.urgencia == 'mes' %}
                        Dentro de um m√™s
                    {% elif prestador.urgencia == 'sem_prazo' %}
                        Sem prazo espec√≠fico
                    {% else %}
                        N√£o especificada
                    {% endif %}
                </p>
                
            {% endif %}
        </div>
        <div class="comments-and-rating container">
            <h2>Avalia√ß√£o</h2>
            <p><strong>Nota M√©dia:</strong> {{ prestador.nota }}</p>
            {% if prestador.feedbacks|length == 0 %}
                <div class="no-feedback">
                    <p>Nenhuma avalia√ß√£o dispon√≠vel para este prestador.</p>
                </div>
            {% else %}
                {% for feedback in prestador.feedbacks[:2] %}
                <div class="feedback-item">
                    <h3>Feedback Cliente</h3>
                    <p><strong>Cliente:</strong> {{ feedback.nome_cliente }}</p>
                    <p><strong>Coment√°rio:</strong> {{ feedback.comentario }}</p>
                    <p><strong>Nota:</strong> {{ feedback.nota }}</p>
                </div>
                {% endfor %}
                {% if prestador.feedbacks|length > 2 %}
                <button id="open-modal-btn" type="button">Ler mais</button>
                {% endif %}
            {% endif %}
        </div>
        
        <!-- Modal -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="texto-content">
                    <div class="top-content">
                        <span class="nome">{{ prestador.nome }}</span>
                        <span class="nota">{{ prestador.nota }}‚≠ê</span>
                    </div>
                    <div class="bottom-content">
                        <h2>Notas & Avalia√ß√µes</h2>
                    </div>
                </div>
                <span class="close">&times;</span>
                <div id="modal-feedbacks"></div>
            </div>
        </div>
        
        <!-- Localiza√ß√£o -->
        <div class="location-info container">
            <h2>Localiza√ß√£o</h2>
            {% if is_owner %}
            <label for="localizacao">CEP:</label>
            <input type="text" id="location" name="localizacao" value="{{ prestador.localizacao }}">
        
            <label for="rua">Rua:</label>
            <input type="text" id="street" name="rua" value="{{ prestador.rua }}">
        
            <label for="bairro">Bairro:</label>
            <input type="text" id="neighborhood" name="bairro" value="{{ prestador.bairro }}">
        
            <label for="cidade">Cidade:</label>
            <input type="text" id="city" name="cidade" value="{{ prestador.cidade }}">
        
            <label for="estado">Estado:</label>
            <input type="text" id="state" name="estado" value="{{ prestador.estado }}">
        
            <!-- Exibe mensagens de erro ou sucesso
            <div id="response" style="color: red;"></div> -->
        {% else %}
            <p><strong>CEP:</strong> {{ prestador.localizacao }}</p>
            <p><strong>Rua:</strong> {{ prestador.rua }}</p>
            <p><strong>Bairro:</strong> {{ prestador.bairro }}</p>
            <p><strong>Cidade:</strong> {{ prestador.cidade }}</p>
            <p><strong>Estado:</strong> {{ prestador.estado }}</p>
        {% endif %}
        </div>
        <div class="certificados container-cert">
            <h2>Certificados</h2>
        
            <div id="certificados-list">
                <!-- Lista de certificados carregados -->
                {% if certificados %}
                    {% for certificado_id, certificado_nome in certificados %}
                        <div class="certificado-item">
                            <div class="certificado-content">
                                {% if certificado_nome.endswith('.png') or certificado_nome.endswith('.jpg') or certificado_nome.endswith('.jpeg') or certificado_nome.endswith('.webp') %}
                                    <!-- Exibir a imagem do certificado e permitir abrir em popup -->
                                    <img src="/uploads/certificado/{{ certificado_id }}" alt="{{ certificado_nome }}" style="max-width: 200px; max-height: 200px;" onclick="abrirPopup('/uploads/certificado/{{ certificado_id }}')">
                                {% elif certificado_nome.endswith('.pdf') %}
                                    <!-- Link para download de arquivos PDF -->
                                    <a href="/uploads/certificado/{{ certificado_id }}" target="_blank">{{ certificado_nome }}</a>
                                {% else %}
                                    <p>{{ certificado_nome }}</p> <!-- Caso o arquivo tenha outro formato, apenas mostre o nome -->
                                {% endif %}
                            </div>
        
                            <!-- √çcone de remover no lado superior esquerdo -->
                            <!-- √çcone de remover no lado superior esquerdo -->
                            {% if is_owner %}
                                <button class="btn-remove" onclick="removerCertificado('{{ certificado_id }}', '{{ certificado_nome }}')" aria-label="Remover">
                                    <span class="remove-icon">&times;</span>
                                </button>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Nenhum certificado carregado.</p>
                {% endif %}
            </div>
        
            {% if is_owner %}
            <h3>Adicionar Certificado:</h3>
            <form id="uploadCertificadoForm" enctype="multipart/form-data">
                <label for="certificados">Carregar Certificados (PDF ou Imagem):</label>
                <input type="file" id="certificados" name="certificados" multiple accept="application/pdf,image/*">
            </form>
            {% endif %}
        </div>
        
        <!-- Estrutura do Popup -->
        <div id="popupCertificado" class="popup">
            <div class="popup-content">
                <span class="popup-close" onclick="fecharPopup()">&times;</span>
                <img id="popupImg" src="" alt="Certificado" style="max-width: 100%; max-height: 100%;">
            </div>
        </div>
        
        
        <!-- Contato -->
        <div class="contact-info container">
            <h2>Contato</h2>
            {% if is_owner %}
            <select id="contactMethod" name="metodo_contato" required>
                <option value="">Selecione a forma de contato</option>
                <option value="email" {% if prestador.metodo_contato == 'email' %}selected{% endif %}>Email</option>
                <option value="telefone" {% if prestador.metodo_contato == 'telefone' %}selected{% endif %}>Telefone</option>
                <option value="whatsapp" {% if prestador.metodo_contato == 'whatsapp' %}selected{% endif %}>WhatsApp</option>
            </select>
                <label for="data_contato">Data Preferida para Contato:</label>
                <input type="date" name="data_contato" value="{{ prestador.data_contato }}">
            {% else %}
            <p><strong>M√©todo de Contato:</strong> {{ prestador.metodo_contato }}</p>
                <p><strong>Data Preferida para Contato:</strong> {{ prestador.data_contato }}</p>
            {% endif %}
        </div>
        

        <!-- M√≠dias Carregadas -->
        <div class="media-section container">
            <h2>Documentos e V√≠deos</h2>
            <div class="gallery">
                <h3>Imagens Carregadas:</h3>
                <div id="preview" class="gallery-container">
                    {% for image_id in images %}
                        <div class="gallery-item">
                            <img src="/uploads/img/{{ image_id }}" alt="Imagem do documento" class="{% if is_owner %}thumbnail{% else %}gallery-item img{% endif %}">
                            {% if is_owner %}
                                <button type="button" class="remove-image" data-file-id="{{ image_id }}">&times;</button>
                            {% endif %}

                        </div>
                    {% endfor %}
                </div>

                {% if is_owner %}
                <input type="file" id="documents" name="documents" multiple accept="image/*">
                <p id="response" class="upload-limit-message"></p>
                {% endif %}
            </div>

            <div class="video-section">
                <h3>V√≠deos Carregados:</h3>
                <div id="video-preview">
                    {% for video_id in videos %}
                        <video controls class="{% if is_owner %}thumbnail{% else %}video-section video{% endif %}">
                            <source src="/uploads/video/{{ video_id }}" type="video/mp4">
                        </video>
                        {% if is_owner %}
                            <button class="remove-video" data-video-id="{{ video_id }}">&times;</button>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if is_owner %}
                <input type="file" id="video" name="video" accept="video/mp4">
                {% endif %}
            </div>
        </div>

        <!-- Bot√£o para salvar as altera√ß√µes -->
        <!-- Bot√£o para salvar as altera√ß√µes -->
        <div class="action-buttons">
            {% if is_owner %}
                <button type="submit" class="btn-save">Salvar Altera√ß√µes</button>
                <div id="response-message" class="response-message"></div>
            {% else %}
            {% endif %}
        </div>
    </div>
    {% if is_owner %}
    <script src="{{ url_for('static', filename='js/perfil_prestador_atualizar.js') }}"></script>
    {% endif %}
</form>
<!-- Coloque o bot√£o de "Solicitar Servi√ßo" fora do formul√°rio de edi√ß√£o -->
<div class="action-buttons">
    {% if not is_owner %}
        <!-- Bot√£o de confirma√ß√£o de solicita√ß√£o -->
        <button class="solicitar-servico-btn" onclick="abrirPopupSolicitacao()">Solicitar Servi√ßo</button>
    {% endif %}
</div>

<!-- Popup de confirma√ß√£o de solicita√ß√£o -->
<div id="popupSolicitacao" class="popup">
    <div class="popup-content-solicitacao">
        <span class="popup-close" onclick="fecharPopupSolicitacao()">&times;</span>
        <h3>Confirmar Solicita√ß√£o de Servi√ßo</h3>

        <div class="solicitacao-details">
            <!-- Tipo de Servi√ßo (n√£o edit√°vel) -->
            <p><strong>Tipo de Servi√ßo:</strong> 
                <span id="tipoServico">{{ prestador.service_type }}</span>
            </p>

            <!-- Descri√ß√£o (n√£o edit√°vel) -->
            <p><strong>Descri√ß√£o:</strong> 
                <span id="descricaoServico">{{ prestador.descricao }}</span>
            </p>

            <!-- Or√ßamento Edit√°vel -->
            <p><strong>Or√ßamento:</strong> 
                <input type="number" id="orcamentoServico" class="editable-field" value="{{ prestador.orcamento }}">
            </p>

            <!-- Urg√™ncia Edit√°vel -->
            <p><strong>Urg√™ncia:</strong> 
                <select id="urgenciaServico" class="editable-field">
                    <option value="urgente">Urgente</option>
                    <option value="semana">Dentro de uma semana</option>
                    <option value="mes">Dentro de um m√™s</option>
                    <option value="sem_prazo">Sem prazo espec√≠fico</option>
                </select>
            </p>

            <!-- Localiza√ß√£o (n√£o edit√°vel) -->
            <p><strong>Localiza√ß√£o:</strong> <span id="localizacaoServico">{{ prestador.localizacao }}</span></p>
            <p><strong>Rua:</strong> <span id="ruaServico">{{ prestador.rua }}</span></p>
            <p><strong>Bairro:</strong> <span id="bairroServico">{{ prestador.bairro }}</span></p>
            <p><strong>Cidade:</strong> <span id="cidadeServico">{{ prestador.cidade }}</span></p>
            <p><strong>Estado:</strong> <span id="estadoServico">{{ prestador.estado }}</span></p>

            <!-- M√©todo de Contato (n√£o edit√°vel) -->
            <p><strong>M√©todo de Contato:</strong> <span id="metodoContatoServico">{{ prestador.metodo_contato }}</span></p>

            <!-- Data de Contato Edit√°vel -->
            <p><strong>Data de Contato:</strong> 
                <input type="date" id="dataContatoServico" class="editable-field" value="{{ prestador.data_contato }}">
            </p>

            <!-- Hora de Contato Edit√°vel -->
            <p><strong>Hora de Contato:</strong> 
                <input type="time" id="horaContatoServico" class="editable-field">
            </p>

            <!-- Bot√£o para mostrar a √°rea de mensagem -->
            <p><span class="icon" onclick="toggleMensagem()"> üìù Adicionar mensagem </span></p>

            <!-- √Årea de mensagem escondida inicialmente -->
            <div id="mensagemContainer" style="display: none;">
                <p><strong>Mensagem ao prestador:</strong></p>
                <textarea id="mensagemCliente" class="editable-field" placeholder="Escreva sua mensagem..."></textarea>
            </div>
        </div>

        <!-- Bot√£o de confirma√ß√£o -->
        <button class="confirmar-servico-btn" onclick="confirmarSolicitacao()">Confirmar Solicita√ß√£o</button>
    </div>
</div>


        <script src="{{ url_for('static', filename='js/prefil_prestador.js') }}"></script>
    <script>
        // Defina uma vari√°vel global no HTML com o valor de 'is_owner'
        var isOwner = {{ is_owner | tojson }};
        // Os dados de feedback j√° est√£o dispon√≠veis no lado do servidor, voc√™ pode renderiz√°-los no JavaScript como um array JSON
        var feedbacks = {{ prestador.feedbacks | tojson }};



        // Defina uma vari√°vel global no HTML com o valor dos dados do prestador
    // Agora voc√™ pode capturar o 'prestador_id' diretamente
    const prestador = {
        prestador_id: "{{ prestador_id }}",  // O prestador_id vem diretamente da URL
        service_type: "{{ prestador.service_type }}",
        descricao: "{{ prestador.descricao }}",
        orcamento: "{{ prestador.orcamento }}",
        urgencia: "{{ prestador.urgencia }}",
        localizacao: "{{ prestador.localizacao }}",
        rua: "{{ prestador.rua }}",
        bairro: "{{ prestador.bairro }}",
        cidade: "{{ prestador.cidade }}",
        estado: "{{ prestador.estado }}",
        metodo_contato: "{{ prestador.metodo_contato }}",
        data_contato: "{{ prestador.data_contato }}"
    };

    console.log("ID do Prestador:", prestador.prestador_id);  // Verifique no console do navegador se o ID aparece corretamente
    </script>
</body>
</html>
